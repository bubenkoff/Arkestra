{% extends "arkestra/generic_list_item.html" %}
{% load typogrify_tags %}
{% spaceless %}
{% block item_title %}
	{# this item is the child of a series that shows the parent's title #}
	{% if "series" in item.show_parent_series %}

		{# the series is informative, so link to it #}
	  	{% if not item.parent.is_uninformative %}
			<a class="title" href="{{ item.parent.get_absolute_url }}">
                {{ item.parent|amp|smartypants|caps|initial_quotes }}
            </a><br>
	  	{% else %}
			<span class="title">{{ item.parent|amp|smartypants|caps|initial_quotes }}</span><br>
	  	{% endif %}

		{# it should show its own title too #}
		{% if "children" in item.show_parent_series %}

	        {% if "details" in lister.format and item.is_uninformative %}
	            <span>{{ item|amp|smartypants|caps|initial_quotes }}</span>
	        {% else %}
	    		{% if item.external_url %}
    	   			<a class="external {{ class }}" href="{{ item.get_absolute_url }}">{{ item|amp|smartypants|caps|initial_quotes }}</a>
                    <span class="site-name"> {{ item.external_url.external_site|amp|smartypants|caps|initial_quotes }}</span>
    		   {% else %}
	    			<a href="{{ item.get_absolute_url }}">{{ item|amp|smartypants|caps|initial_quotes }}</a>
	    		{% endif %}

	    	{% endif %}
	    {% endif %}

	{# either not a child of a series, or we don't display the parent's title #}
	{% else %}
   		{% if item.external_url %}
   			<a class="external title" href="{{ item.get_absolute_url }}">{{ item|amp|smartypants|caps|initial_quotes }}</a>
            <span class="site-name"> {{ item.external_url.external_site|amp|smartypants|caps|initial_quotes }}</span>
		{% else %}
			{% if item.parent.series and not item.parent.is_uninformative %}
				<a class="title" href="{{ item.informative_url }}">{{ item|amp|smartypants|caps|initial_quotes }}</a>
			{% else %}
				{% if not "details" in lister.item_format or not item.is_uninformative %}
		   			<a class="title" href="{{ item.informative_url }}">{{ item|amp|smartypants|caps|initial_quotes }}</a>
				{% else %}
		            <span class="title">{{ item|amp|smartypants|caps|initial_quotes }}</span>
				{% endif %}
	   		{% endif %}
   		{% endif %}
   	{% endif %}
{% endblock item_title %}

{% block item_date %}
    <span class="date">
        {{ item.get_dates }}{% if item.get_times %}, {{ item.get_times|safe }}{% endif %}
    </span>
{% endblock item_date %}

{% block item_details %}
	{% if "details" in lister.item_format or "details" in item.format %}
        {{ block.super }}
        {% if not list.place %}
            {% if item.building %}
                <span class="venue-line">Venue:
                    <span class="venue">
                        <a href="{{item.building.get_absolute_url}}{% if item.building.has_map %}map/{% endif %}">{{ item.building|amp|smartypants|caps|initial_quotes }}</a>
                    </span>
                </span>
            {% endif %}
        {% endif %}
    {% endif %}
{% endblock item_details%}

{% block item_summary %}
    {% if item.calculated_summary %}
        <span class="summary">{{ item.calculated_summary|amp|smartypants|caps|initial_quotes }}</span>
    {% endif %}
{% endblock item_summary %}
{% endspaceless %}
